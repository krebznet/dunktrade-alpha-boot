<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>websocket</title>
    <script src="js/jquery.js"></script>
    <script src="js/sockjs.min.js"></script>
    <script src="js/stomp.js"></script>
  </head>
  <body>
    <div>
      <button id="connect">connect</button>
      <button id="disconnect" disabled="disabled">disconnect</button>
    </div>
    <div>
      <h3>broadcast mode</h3>
      <button id="broadcastButton">send</button>
      <input id="broadcastText" type="text" />
      <label>message：</label>
      <input id="broadcastMsg" type="text" disabled="disabled" />
    </div>
    <div>
      <h3>subscribe mode</h3>
      <label>message：</label>
      <input id="subscribeMsg" type="text" disabled="disabled" />
    </div>
    <div>
      <h3>backend</h3>
      <button id="appButton">send</button><input id="appText" type="text" />
      <label>message：</label>
      <input id="appMsg" type="text" disabled="disabled" />
    </div>
  </body>
  <script>
    var stomp = null;
    $("#connect").click(function () {
      var url = "http://localhost:8080/websocket";
      var socket = new SockJS(url);
      stomp = Stomp.over(socket);

      // connect and receive messages
      stomp.connect({}, function (frame) {
        // broadcast
        stomp.subscribe("/topic/broadcast", function (res) {
          $("#broadcastMsg").val(res.body);
        });

        // subscribe
        stomp.subscribe("/backend/subscribe/1", function (res) {
          $("#subscribeMsg").val(res.body);
        });

        // backend
        stomp.subscribe("/topic/backend", function (res) {
          $("#appMsg").val(res.body);
        });
        setConnect(true);
      });
    });

    // disconnect
    $("#disconnect").click(function () {
      if (stomp != null) {
        stomp.disconnect();
      }
      setConnect(false);
    });
    function setConnect(connectStatus) {
      $("#connect").attr("disabled", connectStatus);
      $("#disconnect").attr("disabled", !connectStatus);
    }

    // send broadcast message
    $("#broadcastButton").click(function () {
      stomp.send(
        "/backend/broadcast",
        {},
        JSON.stringify({ body: $("#broadcastText").val() })
      );
    });

    // send message
    $("#appButton").click(function () {
      stomp.send(
        "/topic/backend",
        {},
        JSON.stringify({ body: $("#appText").val() })
      );
    });
  </script>
</html>
